# gofish
Particle Swarm Optimization scheme for GOSIA/GOSIA2 minimization

This code runs a particle swarm optimization scheme on GOSIA to try to find the best 
minimum. PSO is random and not reproducible. For best results, run multiple instances of this
code and take the best result, then put it into a traditional fitter for fine-tuning. This
code requires GOSIA input files for OP,INTI, OP,MAP, and OP,POIN (for beam and target), with 
several specific modifications to them. The code will draw the boundary conditions from the 
OP,INTI input files (from the bounds you set in OP,EXPT). PSO relies on good selection of
boundary conditions for best results, so try to make them tight where possible (for example,
well known target matrix elements should be constrained to within a few sigma of the
literature value). In the OP,POIN input, comments are needed on the following lines in 
OP,YIEL:

YNRM - please comment this line with !YNRM
UPL - please comment this line with !UPL
NBRA - please comment this line with !BR
NL - please comment this line with !LT
NDL - please comment this line with !DL
NAMX - please comment this line with !ME

These comments are used for functions that parse the input file to be able to find your limits
and constraints. Note that this code is not set up to handle multiple YNRM or UPL values, so 
you will need to select one instance to comment and that's what the code will use.

You will also need to generate format your yields file in a very specific way. Every 
transition that will be generated by OP,POIN needs to be included, and for unobserved
transitions record the counts and uncertainty as 0 for both. The transitions also need to be
listed in the same order as they appear in OP,POIN (if you're not sure what that is, just 
run OP,POIN and check the order and then format them to match that). The parser assumes that
user-generated files, including this one, use comma separated values, not space separated.
Files that GOSIA generates it assumes the default format in which those files are generated.

There are also two changes to the code that need to be made for each user. In 
fileManagement.py, in the first line of the createSubDirectories function, you will need to 
specify the path to where the subdirectories should be created. The use of subdirectories is
so we can run multiple threads simultaneously. The other change is in myconfig.py. You will 
need to modify this file to include the names of your input files. These should not be 
absolute paths, just the file names. The path will be determined by the directory the code is
run in.

Before running this code, I recommend that you get a 'reasonable' fit from GOSIA or another
minimizer. This is so the corrected yields are relatively correct. Alternatively, you can
start with a terrible fit and use this code to iterively find better 'starting' positions
for the integration, but this takes a long time to run and it will likely be much faster to
just get a quick fit from GOSIA first.

After that, you SHOULD be able to run without any additional modifications. I have tried to make
the parser work for any GOSIA input file that follows my formatting constraints, but it's possible
there are types of input files that I did not anticipate. If that's the case, you may need to 
modify the code in parseGosiaInputs.py to get it to read the input files properly.

To actually run the swarm optimizer, call the adaptiveParticleSwarm.py script in the directory
that contains your GOSIA input files. You will also need to pass an integer argument, which only
controls the name of the output file (adaptiveParticleSwarm_XXX.csv, where XXX is your integer). 
The purpose of this is so that when running many instances of the optimizer in parallel, the output
files will have different names. 
